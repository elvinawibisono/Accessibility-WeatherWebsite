<html>
    <head>
        <meta charset="utf-8">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="static/css/reader.css">
        <link rel="stylesheet" href="static/css/magnifier.css">
        <style>
            table{
                border:1px solid black;
    
            }
    
        </style>
    </head>

    <body style="background-color: #fff1d2;" >

        
            <center><h1>Current Weather</h1></center>
     

           <section class="vh-100" style="background-color: #fff1d2;">            
            <div class="container py-5 h-200">

              <div class="row d-flex justify-content-between align-items-center h-200 ">
                <div class="col-md-8 col-lg-6 col-xl-4">
          
                  <div class="card" style="color: #4B515D; border-radius: 35px;">
                    <div class="card-body p-4">
          
                      <div class="d-flex">
                        <h6 class="flex-grow-1">{{city}},{{country}}</h6>
                        <h6>{{date_today}}</h6>
                      </div>
          
                      <div class="d-flex flex-column text-center mt-5 mb-4">
                        <h6 class="display-4 mb-0 font-weight-bold" style="color: #1C2331;"> {{temperature}}°{{unit_symbol}} </h6>
                        <span class="small" style="color: #868B94">{{weather_main}}</span>
                      </div>
          
                      <div class="d-flex align-items-center">
                        <div class="flex-grow-1" style="font-size: 1rem;">
                          <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 40 km/h
                            </span></div>
                          <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 84% </span>
                          </div>
                          <div><i class="fas fa-sun fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 0.2h </span>
                          </div>
                          
                        </div>
                        <div>
                          <img src="static/images/icons/n{{weather_icon}}.png"
                            width="150px">
                        </div>
                      </div>
          
                    </div>
                  </div>
          
                </div>

                <!--Flex Box Right Side-->

                <div class="col-md-4 col-lg-6 col-xl-8">
          
                  <div class="card" style="color: #4B515D; border-radius: 35px;">
                    <div class="card-body p-4">
          
                      <div class="d-flex flex-column justify-content-start align-items-start mb-3">
                        <span class="small" style="font-size: 14px; color: #1C2331;"> {{date_today}}</span>
                        <span class="display-4 font-weight-bold" style="color: #1C2331;">{{time_now}}</span>
                        
                        <div class="d-flex flex-column justify-content-start align-items-center mt-5">
                          <div class="d-flex flex-row justify-content-center align-items-start">
                            <div class="d-flex flex-column align-items-center mr-2 border">
                              <h6 class="mb-0">{{first_hour}}</h6>
                              <img src="static/images/icons/n{{first_icon}}.png"
                                width="50px">
                              <span>{{first_temp}}°{{unit_symbol}}</span>
                            </div>
                            <div class="d-flex flex-column align-items-center mr-2 border">
                              <h6 class="mb-0">{{second_hour}}</h6>
                              <img src="static/images/icons/n{{second_icon}}.png"
                                width="50px">
                              <span>{{second_temp}}°{{unit_symbol}}</span>
                            </div>
                          </div>
                          <div class="d-flex flex-row justify-content-center align-items-center mt-2">
                            <div class="d-flex flex-column align-items-center border">
                              <h6 class="mb-0">{{third_hour}}</h6>
                              <img src="static/images/icons/n{{third_icon}}.png"
                                width="50px">
                              <span>{{third_temp}}°{{unit_symbol}}</span>
                                
                            </div>
                          </div>
                        </div>
                      </div> 
          
                    </div>
                  </div>
          
                </div>

              </div>
              
              <!-- Flex Box Below -->
              <div class="row d-flex justify-content-center align-items-center h-200" style="padding-top: 2rem;">
                <div class="col-md-6 col-lg-8 col-xl-12">
          
                  <div class="card" style="color: #4B515D; border-radius: 35px;">
                    <div class="card-body p-4">
          
                      <div class="d-flex">
                        <h6 class="font-weight-bold mb-0 mr-4 ml-auto " style="color: #1C2331; font-size: 5rem;"> {{temperature}}°{{unit_symbol}} </h6>
                        <h6>{{date_today}}</h6>
                      </div>
          
                      <div class="d-flex flex-column text-center mt-5 mb-4">
                        <h6 class="display-4 mb-0 font-weight-bold" style="color: #1C2331;"> {{temperature}}°{{unit_symbol}} </h6>
                        <span class="small" style="color: #868B94">{{weather_main}}</span>
                      </div>
          
                      <div class="d-flex align-items-center">
                        <div class="flex-grow-1" style="font-size: 1rem;">
                          <div><i class="fas fa-wind fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 40 km/h
                            </span></div>
                          <div><i class="fas fa-tint fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 84% </span>
                          </div>
                          <div><i class="fas fa-sun fa-fw" style="color: #868B94;"></i> <span class="ms-1"> 0.2h </span>
                          </div>
                        </div>
                        <div>
                          <img src="https://openweathermap.org/img/w/{{weather_icon}}.png"
                            width="100px">
                        </div>
                      </div>
          
                    </div>
                  </div>
          
                </div>
              </div>
          
            </div>
          

          </section>

          <button class="open-button" onclick="openForm()">Accessibility</button>

          <div class="form-popup" id="myForm">
            <form action="/action_page.php" class="form-container">
              <h1>Accessibility Features</h1>
  
              <button id="Contrast" type="button" class = "btn" >Contrast</button>
              <button id="Keyboard" type="button" class = "btn" >Keyboard</button>
              <button id="Magnification" type="button" class = "btn" onclick="magnifier()">Magnification</button>
              <button id="accessibility-toggle" type="button" class = "btn" onclick="textToSpeech()">Text-To-Speech</button>
              <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
            </form>
          </div>
  
          <!--Pop Up botton for Accessibility -->
          <script>
            function openForm() {
              document.getElementById("myForm").style.display = "block";
            }
            
            function closeForm() {
              document.getElementById("myForm").style.display = "none";
            }
            
              // text to speech 
            function textToSpeech(){
  
              $(document).ready(function() {
  
    
                var isAccessibilityOn = false;
  
                function highlightElement($element) {
                    if ($element.is("img, p, span, h1, h2, h3, h4, h5, h6, a, label, button")) {
                        $element.addClass("accessibility-highlight");
                    }
                }
  
                function unhighlightElement($element) {
                    $element.removeClass("accessibility-highlight");
                }
  
                function speakText($element, text) {
                  if (!text) {
                      text = $element.clone()
                          .children()
                          .remove()
                          .end()
                          .text();
                  }
  
                  if (isAccessibilityOn) { // Check if the accessibility mode is turned on
                      var utterance = new SpeechSynthesisUtterance(text);
                      utterance.onend = function() {
                          if (callback) {
                              callback();
                          }
                      };
                      speechSynthesis.speak(utterance);
                    }
                }
  
  
                  $(document).on("change", "select", function() {
                      if (isAccessibilityOn) {
                          speakText($(this), $(this).find("option:selected").text());
                      }
                  });
  
  
                  $(document).on("mouseenter", "img, p, span, h1, h2, h3, h4, h5, h6, a, label, button", function() {
                      if (isAccessibilityOn) {
                          highlightElement($(this));
                      }
                  });
  
                  $(document).on("mouseleave", "img, p, span, h1, h2, h3, h4, h5, h6, a, label, button", function() {
                      if (isAccessibilityOn) {
                          unhighlightElement($(this));
                      }
                  });
  
                  $(document).on("keydown", function(e) {
                      if (e.keyCode === 32 && e.target.tagName !== "INPUT" && e.target.tagName !== "TEXTAREA") {
                          var $highlighted = $(".accessibility-highlight:hover");
                          if ($highlighted.length > 0) {
                              speakText($highlighted);
                          }
                      }
                  });
  
                  $("#accessibility-toggle").on("click", function() {
                      isAccessibilityOn = !isAccessibilityOn;
                      if (isAccessibilityOn) {
                        speakText($(this), "Accessibility mode turned on. Hover over a text or image element and press space to read it.", function() {
                        highlightElement($(".accessibility-highlight"));
                        });
                      } else {
                        speechSynthesis.cancel();
                        unhighlightElement($(".accessibility-highlight"));
                        speakText($(this), "Accessibility mode turned off", function() {
                          $(".temp-element").remove();
                        });
                      }
  
                  });
                
              });
              
            }

            // Debug this
              // magnification
            function magnifier(){

              $(document).ready(function(){

                var zoom = 1.0; 
                var body_width = document.body.clientWidth; 
                var body_height = document.body.clientHeight; 

                document.addEventListener('keydown', function(e){
                    
                    //Browser Zoom 
                    if (e.key == "-"){
                        zoom -= 0.1; 
                        zoomString = zoom.toFixed(1).toString(); 
                        document.body.style.zoom = zoomString; 
                    }
                    else if(e.key == "="){
                        zoom += 0.1; //change it to string
                        zoomString = zoom.toFixed(1).toString(); 
                        document.body.style.zoom = zoomString; 

                    }

                    if (e.key == "+" || e.key == "_"){
                        $("body").css("position","relative");
                        //Graphical Zoom
                        if (e.key == "+"){
                            zoom += 0.1; 

                        }
                        else if(e.key == "_"){
                            zoom -= 0.1; 

                        }
                        var newWidth = zoom.toFixed(1) * body_width; 
                        var newHeight = zoom.toFixed(1) * body_height; 

                        var pixel_width = (newWidth-body_width)/2; 
                        var pixel_height = (newHeight-body_height)/2; 
                        $("body").css("left", pixel_width.toString() + "px"); 
                        $("body").css("top", pixel_height.toString() + "px"); 
                        $("body").css("transform", 'scale(${zoom.toFixed(1)}'); 

                        if(zoom.toFixed()==1.0){
                            $("body").css("transform", "");
                        }


                    } 

                });


                var oldx = 0; 
                var oldy = 0; 

                document.addEventListener('mousemove', e=>{

                    var x= e.clientX
                    var scrollLeftValue = $(document).scrollLeft(); 

                    // if the coo relative to the window seem are less than 100px
                    //and if the coo of the old move are grater than the coo of the new move
                    // and if the coo relative to the window are not equal to coo of the move

                    if((x<=100) & (oldx>e.pageX) &(x !=e.pageX)){
                        $(document).scrollLeft(scrollLeftValue -10); 

                    }

                    //if the window width minus the coo relative to the window are less than 100 
                    // and if the coo of the old moce are less than the coo of new move
                    //scroll other way 
                    if(($(window).width() -x) <100 & (oldx <e.pageX)){
                        $(document).scrollLeft(scrollLeftValue +10);
                    }

                    oldx = e.pageX
                    oldy = e.pageY

                }); 


                $("*:not(body)").on("mouseenter", function(ev){

                    //may want to remove leftover highlights vefore highlighting a new 
                    $(".highlight").removeClass("highlight")
                    //when a mouse enters an element
                    $(this).addClass("highlight")

                    //to prevent multiple elements from being highlighted 
                    //we will only highlight the first element so we need to call the following
                    //to stop hovering on a child from highloghting the parent
                    ev.stopPropagation(); 

                    //set the element variable
                    element = this; 
                });

                $("*:not(body)").on("mouseleave", function(ev){
                    $(this).removeClass("highlight"); 

                    $(".highlight").removeClass("highlight")

                });

                document.addEventListener("keydown", function(e){

                    if(e.code == ""|| e.code == "Space"){
                        //need to stop the page from scrolling down when we press space
                        if(e.stopPropagation){
                            e.stopPropagation(); 
                            e.preventDefault(); 
                        }

                        //if text is highighted and there is no refactored window open 
                        //make a refactored window
                        //otherwise the window is open so close it

                        //check if div exist
                        if($(element).hasClass("highlight") & $('#mydiv').length == 0){
                            //var newImage = new Image(); 

                            $("body").append($("<div id = 'mydiv'></div>"))


                            var imgsrc = $(element).attr("src"); 
                            var imgalt = $(element).attr("alt"); 

                            if($(element).attr("alt") && $(element).attr("src")){
                                

                                $('#mydiv').append($("<img class = 'magnified' alt=" + imgalt + " src=" + imgsrc+">")); 
                                $('.magnified').css({'width': '100%', 'height': '100%'})
                                $('.magnified').css('object-fit', 'contain'); 
                                $('#mydiv').css('height', '75%')



                            }

                            else if($(element).attr("src")){
                                $('#mydiv').append($("<img class = 'magnified' src =" + imgsrc+">")); 
                        
                                $('.magnified').css({'width': '100%', 'height': '100%'})
                                $('.magnified').css('object-fit', 'contain'); 
                                $('#mydiv').css('height', '75%')
                            }

                            //else the element is not an image and it's stext 
                            else{
                                //write the text to the div
                                $('#mydiv').html($(".highlight").text()); 
                                //might want to add background color for text 
                                $('#mydiv').css('background-color', 'white')
                                $('#mydiv').css('border-radius', "25px")
                                $('#mydiv').css('border', '1px solid black')
                                $('mydiv').css('padding', "25px")
                            }


                        }
                        //else remove 
                        else{
                            $("#mydiv").html("")
                            $("#mydiv").remove()

                        }
                    }
                    else{
                        $(".highlight").removeClass("highlight")
                    }
                });



              });


              }
  
          </script>






    </body>

   

</html>